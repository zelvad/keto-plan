"use strict";var ImpWidget=function(e){var t,o,i,r,n,a="https://api-stage.impaya.ru",d=this;d.Token=e.Token,d.Amount=e.Amount,d.Currency=e.Currency,d.Receipt=!!e.Receipt&&e.Receipt,d.Email=e.Email?e.Email:"",d.OrderID=e.OrderID?e.OrderID:"imp_widget_"+generateOrderID(10),d.ProductName=e.ProductName?encodeURI(e.ProductName):"",d.CustomParams=e.CustomParams?e.CustomParams:[],e.AutoClose&&(d.AutoClose=e.AutoClose),e.ShowGoods&&(d.ShowGoods=e.ShowGoods),e.Goods&&(d.Goods=e.Goods),(t=document.createElement("div")).setAttribute("id","imp-widget-wrapper"),t.style.cssText="z-index:9997;text-align:left;height:100%;width:100%;position:fixed;left:0px;top:0px;transition:opacity0.15sease0s;overflow:hidden;pointer-events:all;opacity:1;",(i=document.createElement("div")).setAttribute("id","imp-widget-background"),i.style.cssText="z-index:9998;background:rgb(255,255,255);opacity:0.75;position:fixed;left:0px;top:0px;bottom:0px;right:0px;border:0px;overflow:visible;transition:all .5s ease",(r=document.createElement("div")).setAttribute("id","imp-widget-layout"),r.style.cssText="width:100%;height:100%;border:none;z-index:9999;text-align:center",(n=document.createElement("div")).setAttribute("id","imp-widget-loader"),n.style.cssText="z-index:9998;width:100%;position:fixed;bottom:45%;height:120px;background-position:50%;background-repeat:no-repeat;background-size:120px;background-image:url(https://static-stage.impaya.ru/widget/loader.svg)",r.appendChild(n),(o=document.createElement("iframe")).setAttribute("id","imp-widget-iframe"),o.setAttribute("frameborder","0"),o.setAttribute("allowpaymentrequest",""),o.setAttribute("scrolling","no"),o.style.cssText="position:fixed;width:100%;height:100%;left:0;right:0;top:0;left:0;border:none;z-index:9999;",r.appendChild(o),t.appendChild(i),t.appendChild(r),document.body.appendChild(t),function(e,t,o){var i={token:e.Token,merchant_order_id:e.OrderID.toString(),amount:e.Amount,custom_params:e.CustomParams};e.Email&&""!=e.Email&&i.custom_params.push({key:"Email",value:e.Email}),e.ProductName&&""!=e.ProductName&&i.custom_params.push({key:"ProductName",value:decodeURI(e.ProductName)}),e.Goods&&(i.goods=e.Goods),fetch(a+"/PaymentInit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then((e=>e.json())).then((e=>{e.success?(d.SessionID=e.session_id,setTimeout((function(){t()}),500)):(console.log(new Error(e.ErrCode+":"+e.ErrMessage)),o())})).catch((e=>{console.log(e),o()}))}(d,(function(){n.style.display="none",i.style.background="rgb(0,0,0)";var e=d;if("undefined"!=e&&null!=e){var t=a+"/Payment?";for(var r in e){var s=e[r];if("Goods"==r)for(var m=0;m<s.length;m++)t=t+r+"="+encodeURIComponent(s[m].name)+"goods-price-delim"+encodeURIComponent(s[m].price)+"&";else t=t+r+"="+s+"&"}t=t.substring(0,t.length-1)}o&&(o.src=t)}),(function(){var e=document.getElementById("imp-widget-wrapper");e.parentElement.removeChild(e)}))};function generateOrderID(e){for(var t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<e;i++)t+=o.charAt(Math.floor(Math.random()*o.length));return t}window.addEventListener("message",(function(e){if(("https://api-stage.impaya.ru"==e.origin||"https://api-stage-proxy.impaya.ru"==e.origin)&&"closeFrame"==e.data.trigger){var t=document.getElementById("imp-widget-wrapper");t.parentElement.removeChild(t)}}));